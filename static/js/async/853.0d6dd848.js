"use strict";(self.webpackChunkform_crafter=self.webpackChunkform_crafter||[]).push([["853"],{2538:function(e,l,t){t.d(l,{A:()=>y,L:()=>T});var i=t("5893"),n=t("4058"),s=t("2447"),a=t("3708"),r=t("3025"),o=t("8142"),d=t("3718"),c=t("3742"),u=t("1571"),m=t("4979"),x=t("8971"),h=t("1012"),p=t("1211"),f=t("9410"),v=t("7294"),g=t("8932");let j=g.z.array(g.z.object({id:g.z.string().default(""),field:g.z.string().optional(),type:g.z.enum(["input","select","radio","checkbox","textarea","date","time","datetime"]).default("input"),description:g.z.string().optional(),required:g.z.boolean().optional(),prefill:g.z.string().array().optional(),maxLength:g.z.number().optional(),minLength:g.z.number().optional(),options:g.z.array(g.z.object({label:g.z.string(),description:g.z.string().optional()})).optional()})),b=(0,v.createContext)(null),N=()=>{let e=(0,v.useContext)(b);if(!e)throw Error("useDesignerField must be used within a DesignerFieldProvider");return e},y=(0,v.forwardRef)((e,l)=>{let{onSave:t,onFormChange:p,onFormFocus:v,formKey:g="schema-form",back:N,isSubmitting:y,actions:k,...L}=e,[C]=(0,a.u)({duration:150});return(0,i.jsx)(s.l0,{ref:l,autoScrollToError:!0,...L,onSubmit:e=>null==t?void 0:t((null==e?void 0:e.form)||[]),onChange:e=>{var l;return null==p?void 0:p((null===(l=e.values)||void 0===l?void 0:l.form)?[...e.values.form]:[])},children:e=>{let{formState:l,formApi:t}=e;return(0,i.jsx)(s.OF,{field:"form",children:e=>{let{arrayFields:a,addWithInitValue:p}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"py-3",children:(0,i.jsxs)("div",{className:"flex justify-between items-center gap-2 pr-8",children:[(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(s.hE,{children:[(0,i.jsx)(s.zx,{icon:(0,i.jsx)(r.Z,{}),onClick:async()=>{let{data:e,ok:l}=function(e){try{let l=JSON.parse(e);return{data:j.parse(l),ok:!0}}catch(e){return console.log(e),{data:void 0,ok:!1}}}(await navigator.clipboard.readText());l?t.setValue("form",e):s.FN.error("剪贴板内容无效")},children:"导入"}),(0,i.jsx)(s.zx,{icon:(0,i.jsx)(o.Z,{}),onClick:async()=>{let e=t.getValues();await navigator.clipboard.writeText(JSON.stringify(e.form)),s.FN.success("已复制到剪贴板")},children:"导出"})]}),(0,i.jsx)(s.gn,{title:"确定要清空表单设计器内容吗？",okType:"danger",onConfirm:()=>{t.reset(),localStorage.removeItem(g)},children:(0,i.jsx)(s.zx,{icon:(0,i.jsx)(d.Z,{}),type:"danger",children:"清空"})})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[k,(0,i.jsx)(s.zx,{type:"primary",theme:"solid",icon:(0,i.jsx)(c.Z,{}),loading:y,onClick:async()=>{let e=await t.validate();localStorage.setItem(g,JSON.stringify(e.form)),t.submitForm()},children:"保存"})]})]})}),(0,i.jsx)("div",{ref:C,onBlur:()=>null==v?void 0:v(void 0),children:a.map((e,r)=>{var o,d;let{field:c,key:h,remove:p}=e,f=null===(d=l.values)||void 0===d?void 0:null===(o=d.form)||void 0===o?void 0:o[r],g=(null==f?void 0:f.field)??`字段 ${r+1}`;return(0,i.jsx)(b.Provider,{value:{field:c,value:f,type:null==f?void 0:f.type},children:(0,i.jsxs)("div",{id:null==f?void 0:f.id,className:"py-3 flex items-stretch [&>:first-child]:focus-within:border-focus [&>:first-child]:focus-within:shadow-elevated",onFocus:()=>null==v?void 0:v(null==f?void 0:f.id),children:[(0,i.jsxs)("section",{className:"px-5 pt-5 pb-2 border rounded-medium bg-bg-1 flex-grow transition",children:[(0,i.jsxs)("div",{className:"sticky z-10 top-0 flex gap-2 items-center -mt-2 pt-2 pb-3 bg-gradient-to-b from-bg-1 via-35% via-bg-1 pointer-events-none *:pointer-events-auto",children:[(0,i.jsx)("div",{className:"flex items-center justify-center h-6 min-w-6 text-large/none text-text-3 border rounded-full bg-bg-2",children:r+1}),(0,i.jsx)("h5",{className:(0,n.cn)("text-h5 font-bold",(null==f?void 0:f.required)&&"after:content-['*'] after:text-danger after:ml-1"),children:g})]}),(0,i.jsxs)("div",{className:"sm:grid sm:grid-cols-12 sm:gap-x-4",children:[(0,i.jsx)(s.l0.Select,{fieldClassName:"col-span-4",className:"w-full",field:`${c}.type`,label:"类型",defaultActiveFirstOption:!0,optionList:[{label:"单行文本",value:"input"},{label:"下拉选择",value:"select"},{label:"单选",value:"radio"},{label:"多选",value:"checkbox"},{label:"多行文本",value:"textarea"},{label:"日期",value:"date"},{label:"时间",value:"time"},{label:"日期时间",value:"datetime"}],rules:[{required:!0,message:"字段类型不能为空"}],placeholder:"请选择字段类型"}),(0,i.jsx)(s.l0.Input,{fieldClassName:"col-span-6",className:"w-full",field:`${c}.field`,label:{text:"字段名",extra:(0,i.jsxs)(w,{children:["表单显示的标签。",(0,i.jsx)("br",{}),"简明描述该项应该填写的内容。",(0,i.jsx)("br",{}),"建议",(0,i.jsx)("b",{children:"不超过 8 个字"}),"，更详细的信息请写到提示中。"]})},rules:[{required:!0,message:"字段名不能为空"},{max:20,message:"字段名长为 20 个字符"}],placeholder:`字段 ${r+1}`}),(0,i.jsx)(s.l0.Switch,{fieldClassName:"col-span-2",field:`${c}.required`,label:"必填项"}),(0,i.jsx)(s.l0.Input,{fieldClassName:"col-span-12",field:`${c}.description`,label:{text:"提示",extra:(0,i.jsx)(w,{children:"表单项目的描述，用于提示用户该表单项目的用途，以及如何填写。"})},placeholder:"无提示"}),(0,i.jsx)($,{})]})]}),(0,i.jsx)("div",{className:"py-2",children:(0,i.jsxs)("div",{className:"sticky top-4 flex flex-col gap-2 [&_button]:rounded-l-none",children:[(0,i.jsx)(s.u,{content:"删除",position:"right",children:(0,i.jsx)(s.zx,{className:"rounded-l-none",type:"danger",onClick:()=>{let e=t.getValues();p();let l=s.FN.success({content:(0,i.jsxs)("span",{children:["已删除",(0,i.jsxs)("span",{children:["「",g,"」"]}),(0,i.jsx)("button",{type:"button",className:"ml-3 font-semibold text-link hover:text-link-hover active:text-link-active",onClick:()=>{t.setValue("form",e.form),s.FN.close(l)},children:"撤销"})]})})},icon:(0,i.jsx)(u.Z,{})})}),(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)(s.u,{content:"上移",position:"right",children:(0,i.jsx)(s.zx,{icon:(0,i.jsx)(m.Z,{}),className:"rounded-b-none",onClick:()=>{var e;if(0===r)return;let i=(null===(e=l.values)||void 0===e?void 0:e.form)??[];[i[r],i[r-1]]=[i[r-1],i[r]],t.setValue("form",i)}})}),(0,i.jsx)("div",{className:"border-b border-border"}),(0,i.jsx)(s.u,{content:"下移",position:"right",children:(0,i.jsx)(s.zx,{icon:(0,i.jsx)(x.Z,{}),className:"rounded-t-none",onClick:()=>{var e;if(r===a.length-1)return;let i=(null===(e=l.values)||void 0===e?void 0:e.form)??[];[i[r],i[r+1]]=[i[r+1],i[r]],t.setValue("form",i)}})})]})]})})]})},(null==f?void 0:f.id)||h)})}),(0,i.jsx)("div",{className:"pr-8",children:(0,i.jsx)(s.zx,{className:"my-3 rounded-medium",block:!0,theme:"outline",size:"large",onClick:()=>p({id:(0,f.x0)(8),type:"input"}),icon:(0,i.jsx)(h.Z,{}),children:"添加字段"})})]})}})}})}),w=e=>{let{children:l}=e;return(0,i.jsx)(s.u,{content:l,children:(0,i.jsx)(p.Z,{className:"size-4 text-text-2"})})};function $(){let{field:e,type:l}=N();if(!l)return null;switch(l){case"input":case"textarea":return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k,{className:"col-span-4",isText:!0}),(0,i.jsx)(s.l0.Input,{fieldClassName:"col-span-8",field:`${e}.prefill`,label:"默认值",placeholder:"无默认值"})]});case"select":case"checkbox":return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k,{className:"col-span-4"}),(0,i.jsx)(L,{className:"col-span-8"}),(0,i.jsx)(C,{className:"col-span-12"})]});case"radio":return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(L,{className:"col-span-12"}),(0,i.jsx)(C,{className:"col-span-12"})]});default:return null}}let k=e=>{let{isText:l,className:t}=e,{field:a,type:r}=N();return(0,i.jsxs)("div",{className:(0,n.cn)("grid grid-cols-2 gap-2",t),children:[(0,i.jsx)(s.l0.InputNumber,{className:"w-full",field:`${a}.minLength`,label:l?"最少字数":"选择下限",min:0,showClear:!0,innerButtons:!0,placeholder:"select"===r?"单选":"无限制"}),(0,i.jsx)(s.l0.InputNumber,{className:"w-full",field:`${a}.maxLength`,label:l?"最多字数":"选择上限",min:0,showClear:!0,innerButtons:!0,placeholder:"select"===r?"单选":"无限制"})]})},L=e=>{var l;let{className:t}=e,{field:n,value:a,type:r}=N();return(0,i.jsx)(s.l0.Select,{fieldClassName:t,className:"w-full",field:`${n}.prefill`,label:"默认选择",multiple:"radio"!==r&&"select"===r&&(!!(null==a?void 0:a.maxLength)&&a.maxLength>1||!!(null==a?void 0:a.minLength)&&a.minLength>1),max:"radio"!==r&&(null==a?void 0:a.maxLength)?a.maxLength:void 0,optionList:(null==a?void 0:null===(l=a.options)||void 0===l?void 0:l.filter(e=>e).map(e=>({label:null==e?void 0:e.label,value:null==e?void 0:e.label})))??[],placeholder:"无默认选择",showClear:!0},`${n}.prefill`)},C=e=>{let{className:l}=e,{field:t,type:r}=N(),[o]=(0,a.u)({duration:100});return(0,i.jsx)("div",{className:(0,n.cn)("-mx-5 px-5 pt-2 mt-2 border-t",l),children:(0,i.jsx)(s.OF,{field:`${t}.options`,children:e=>{let{add:l,arrayFields:t}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{ref:o,children:t.map((e,l)=>{let{field:t,key:a,remove:o}=e;return(0,i.jsxs)("div",{className:"grid grid-cols-[1fr_auto] gap-2",children:[(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsx)(s.l0.Input,{fieldClassName:(0,n.cn)("flex-grow","select"===r&&"basis-1/2"),field:`${t}.label`,placeholder:`选项 ${l+1}`,rules:[{required:!0,message:"选项不能为空"},{max:"select"===r?80:20,message:"select"===r?"选项最长 80 个字符":"选项最长 20 个字符"}],noLabel:!0}),"select"!==r&&(0,i.jsx)(s.l0.Input,{fieldClassName:"basis-1/2",field:`${t}.description`,placeholder:"无提示",noLabel:!0})]}),(0,i.jsx)("div",{className:"py-3",children:(0,i.jsx)(s.zx,{type:"danger",theme:"borderless",icon:(0,i.jsx)(u.Z,{}),onClick:o})})]},a)})}),(0,i.jsx)("div",{className:"py-3 pr-10",children:(0,i.jsx)(s.zx,{block:!0,icon:(0,i.jsx)(h.Z,{}),onClick:l,children:"添加选项"})})]})}})})};var z=t("5077");let T=(0,v.forwardRef)((e,l)=>{let{schema:t=[],onSubmit:a,preview:r,children:o,...d}=e,c=t.map((e,l)=>{if(!e)return null;let t=e.field??`字段 ${l+1}`,a={field:e.id,label:t,extraText:e.description,initValue:e.prefill},o=e.required?[{required:!0,message:`${t}不能为空`}]:[],d=(()=>{var l,n,r;switch(e.type){case"input":return(0,i.jsx)(s.l0.Input,{...a,rules:[...o,{max:e.maxLength||void 0,message:`${t}最多 ${e.maxLength} 个字符`},{min:e.minLength||void 0,message:`${t}最少 ${e.minLength} 个字符`}]},e.id);case"select":return(0,i.jsx)(s.l0.Select,{className:"w-full",...a,rules:[...o,{validator:(l,t)=>!e.minLength||t.length>e.minLength,message:`${t}最少选择 ${e.minLength} 项`}],multiple:e.maxLength?e.maxLength>1:void 0,max:e.maxLength||void 0,optionList:(null==e?void 0:null===(l=e.options)||void 0===l?void 0:l.filter(e=>e).map(e=>({label:null==e?void 0:e.label,value:null==e?void 0:e.label})))??[],showClear:!e.required},e.id);case"radio":return(0,i.jsx)(s.l0.RadioGroup,{...a,rules:o,options:(null===(n=e.options)||void 0===n?void 0:n.filter(e=>e).map(e=>({label:null==e?void 0:e.label,value:null==e?void 0:e.label,extra:null==e?void 0:e.description})))??[]},e.id);case"checkbox":return(0,i.jsx)(s.l0.CheckboxGroup,{...a,rules:[...o,{validator:(l,t)=>!e.minLength||t.length>e.minLength,message:`${t}最少选择 ${e.minLength} 项`},{validator:(l,t)=>!e.maxLength||t.length<e.maxLength,message:`${t}最多选择 ${e.maxLength} 项`}],options:(null===(r=e.options)||void 0===r?void 0:r.filter(e=>e).map(e=>({label:null==e?void 0:e.label,value:null==e?void 0:e.label,extra:null==e?void 0:e.description})))??[]},e.id);case"textarea":return(0,i.jsx)(s.l0.TextArea,{...a,rules:[...o,{max:e.maxLength||void 0,message:`${t}最多 ${e.maxLength} 个字符`},{min:e.minLength||void 0,message:`${t}最少 ${e.minLength} 个字符`}],maxCount:e.maxLength||void 0,autosize:!0},e.id);case"date":return(0,i.jsx)(s.l0.DatePicker,{className:"w-full",...a,rules:o},e.id);case"time":return(0,i.jsx)(s.l0.TimePicker,{className:"w-full",...a,rules:o,format:"HH:mm"},e.id);case"datetime":return(0,i.jsx)(s.l0.DatePicker,{className:"w-full",...a,rules:o,type:"dateTime"},e.id);default:return null}})();if(!r)return d;let{highlightField:c,highlightClassName:u,onLocate:m}=r;return(0,i.jsxs)("div",{"data-highlight":c===e.id?"":void 0,className:(0,n.cn)("group relative",c===e.id&&u),children:[d,m&&(0,i.jsx)("div",{className:"absolute top-2 right-0 opacity-0 group-hover:opacity-100 group-data-[highlight]:hidden",children:(0,i.jsx)(s.u,{position:"topRight",content:"在表单设计器中定位",children:(0,i.jsx)(s.zx,{type:"tertiary",theme:"outline",onClick:()=>m(e.id),size:"small",icon:(0,i.jsx)(z.Z,{})})})})]},e.id)});return!r||c.length>0?(0,i.jsxs)(s.l0,{autoScrollToError:!0,onSubmit:a,ref:l,...d,children:[c,o]}):(0,i.jsx)("div",{className:"py-3 text-center text-sm text-text-2",children:(null==r?void 0:r.empty)??"请在表单设计器中添加字段"})})},792:function(e,l,t){t.d(l,{LA:function(){return o},Mr:function(){return n},Vb:function(){return r},X2:function(){return u},ez:function(){return d},tn:function(){return c},x6:function(){return a}});let i="https://survey.115.zone";function n(e){return{name:e.title,deadline:e.deadline,json_config:{model:e.schema}}}function s(e){return{id:String(e.id),title:e.name,deadline:e.deadline,schema:e.json_config.model}}let a=async()=>{let e=await fetch(`${i}/survey`);if(!e.ok)throw Error(e.statusText);return(await e.json()).map(s)},r=async e=>{let l=await fetch(`${i}/survey`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!l.ok)throw Error(l.statusText);return await l.json()},o=async e=>{let l=await fetch(`${i}/survey/${e}`);if(!l.ok)throw Error(l.statusText);return s(await l.json())},d=async(e,l)=>{let t=await fetch(`${i}/survey/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!t.ok)throw Error(t.statusText);return await t.json()};async function c(e,l){let t=await fetch(`${i}/survey/${e}/answer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answer_data:l})});if(!t.ok)throw Error(t.statusText);return t}async function u(e){let l=await fetch(`${i}/survey/${e}/answer`);if(!l.ok)throw Error(l.statusText);return await l.json()}},4058:function(e,l,t){t.d(l,{cn:function(){return s}});var i=t(7026),n=t(19);function s(){for(var e=arguments.length,l=Array(e),t=0;t<e;t++)l[t]=arguments[t];return(0,n.m6)((0,i.W)(l))}}}]);
"use strict";(self.webpackChunkform_crafter=self.webpackChunkform_crafter||[]).push([["482"],{8827:function(e,t,a){a.d(t,{l:()=>N});var s=a("5893"),l=a("2447"),n=a("470"),i=a("7294");function r(e){let{value:t,onChange:a}=e,[r,c]=(0,i.useState)(!1);return(0,s.jsx)("div",{className:"-mx-1",children:r?(0,s.jsx)(l.II,{className:"font-bold",size:"large",value:t,onChange:e=>a(e),onBlur:()=>c(!1),autoFocus:!0}):(0,s.jsxs)("button",{type:"button",className:"flex items-center justify-start gap-2 rounded w-full font-bold cursor-pointer text-left text-xl px-1 py-1.5 hover:bg-fill-0 active:bg-fill-2",onClick:()=>c(!0),children:[t,(0,s.jsx)(n.Z,{className:"opacity-50 size-3.5"})]})})}var c=a("2538"),d=a("792"),x=a("9469"),o=a("3760"),u=a("4333"),m=a("7307"),h=a("1012"),v=a("6619"),p=a("5410"),g=a("4507"),j=a("4058"),y=a("3271");function f(e){let{model:t,data:a,...n}=e;return(0,s.jsx)(l.w5,{data:w(t,a),...n})}let w=(e,t)=>{let a=[],n=e=>(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.map(e=>(0,s.jsx)(l.Vp,{children:e},`${e}`))});return Object.entries(t).map(t=>{let[i,r]=t,c=e.find(e=>e.id===i);if(!c)return;let d=(0,s.jsx)(l.Sx.Text,{className:"max-w-[112px]",type:"tertiary",ellipsis:{showTooltip:!0},children:c.field??"字段"},c.field);switch(c.type){case"input":case"textarea":case"radio":a.push({key:d,value:r});break;case"select":c.minLength&&c.minLength>1?a.push({key:d,value:n(r)}):a.push({key:d,value:r});break;case"checkbox":a.push({key:d,value:n(r)});break;case"date":a.push({key:d,value:(0,y.Z)(new Date(r),"yyyy-MM-dd")});break;case"time":a.push({key:d,value:(0,y.Z)(new Date(r),"HH:mm")});break;case"datetime":a.push({key:d,value:(0,y.Z)(new Date(r),"yyyy-MM-dd HH:mm")})}}),a};function b(e){let{initialData:t,onSave:a,onCreated:n}=e,[d,u]=(0,i.useState)((null==t?void 0:t.title)||"新表单"),[h,v]=(0,i.useState)((null==t?void 0:t.deadline)||new Date(new Date().setDate(new Date().getDate()+1)).toISOString()),[p,j]=(0,i.useState)((null==t?void 0:t.schema)||[]),[y,f]=(0,i.useState)(),w=(0,x.NL)(),{mutate:b,isPending:N}=(0,o.D)({mutationFn:async e=>null==a?void 0:a(e),onError:e=>{l.FN.error(`保存失败：${e.message}`)},onSuccess:async e=>{e&&(!t&&(null==n||n(String(null==e?void 0:e.id))),await w.invalidateQueries({queryKey:["survey",String(e.id)]}),await w.invalidateQueries({queryKey:["surveys"]}))}}),D=(0,i.useMemo)(()=>[{text:"明天",start:new Date(new Date().setDate(new Date().getDate()+1)),end:new Date(new Date().setDate(new Date().getDate()+1))},{text:"一周后",start:new Date(new Date().setDate(new Date().getDate()+7)),end:new Date(new Date().setDate(new Date().getDate()+7))},{text:"一个月后",start:new Date(new Date().setMonth(new Date().getMonth()+1)),end:new Date(new Date().setMonth(new Date().getMonth()+1))}],[]);return(0,s.jsx)("div",{className:"max-w-screen-2xl w-full mx-auto px-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-[minmax(0,1fr)_380px] 2xl:grid-cols-[minmax(0,1fr)_440px] gap-x-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"pr-9 py-2",children:(0,s.jsx)(r,{value:d,onChange:u})}),(0,s.jsxs)("div",{className:"pr-8 py-2 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"font-bold text-sm",children:"截止时间"}),(0,s.jsx)(l.Mt,{type:"dateTime",value:h,onChange:e=>v(e.toISOString()),presets:D})]}),(0,s.jsx)(c.A,{onFormChange:j,onSave:e=>b({title:d,deadline:h,schema:e}),onFormFocus:e=>f(e),isSubmitting:N,actions:(null==t?void 0:t.id)?(0,s.jsx)(l.J2,{trigger:"click",content:(0,s.jsx)("div",{className:"p-3",children:(0,s.jsx)(g.t,{value:`${location.origin}/answer/${t.id}`,size:96})}),children:(0,s.jsx)(l.zx,{icon:(0,s.jsx)(m.Z,{}),children:"分享"})}):void 0})]}),(0,s.jsxs)("div",{className:"max-lg:border-t pt-5 lg:h-full lg:relative lg:pt-20",children:[(0,s.jsx)("h3",{className:"text-large font-bold mb-2 px-2",children:"预览"}),(0,s.jsx)("div",{className:"lg:sticky lg:top-4 border bg-bg-1 py-2 px-5 rounded-medium lg:max-h-[calc(100vh-2rem)] overflow-auto",children:(0,s.jsx)(c.L,{preview:{highlightField:y,highlightClassName:"rounded ring-1 ring-primary shadow-knob px-3 -mx-3",onLocate:e=>{var t;let a=document.getElementById(e);a&&(a.scrollIntoView({behavior:"smooth"}),null===(t=a.querySelector("input.semi-input"))||void 0===t||t.focus({preventScroll:!0}))}},schema:p})})]})]})})}function N(e){let{initialData:t}=e,a=(0,v.s)(),n=(0,i.useCallback)(async e=>t?await (0,d.ez)(t.id,(0,d.Mr)(e)):await (0,d.Vb)((0,d.Mr)(e)),[t]),r=(0,i.useCallback)(e=>a({to:"/survey/$surveyId",params:{surveyId:e}}),[a]);return(0,s.jsxs)("div",{className:"grid grid-cols-[200px_minmax(0,1fr)] 2xl:grid-cols-[240px_minmax(0,1fr)]",children:[(0,s.jsxs)("div",{className:"sticky top-0 h-screen border-r overflow-auto",children:[(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)(l.zx,{icon:(0,s.jsx)(h.Z,{}),onClick:()=>a({to:"/survey/new"}),block:!0,children:"创建表单"})}),(0,s.jsx)(D,{currentId:null==t?void 0:t.id})]}),t?(0,s.jsx)("main",{children:(0,s.jsxs)(l.mQ,{tabPaneMotion:!1,renderTabBar:(e,t)=>(0,s.jsx)(t,{...e,className:"px-4 [&>.semi-tabs-tab]:py-2.5"}),children:[(0,s.jsx)(l.Jm,{tab:"编辑表单",itemKey:"edit",className:"overflow-visible",children:(0,s.jsx)(b,{initialData:t,onSave:n})}),(0,s.jsx)(l.Jm,{tab:"收集结果",itemKey:"preview",className:"overflow-visible",children:(0,s.jsx)(k,{surveyId:t.id,schema:t.schema})})]})}):(0,s.jsx)("main",{className:"py-2",children:(0,s.jsx)(b,{onSave:n,onCreated:r})})]})}function D(e){let{currentId:t}=e,{data:a,isPending:n,isError:i,refetch:r}=(0,u.a)({queryKey:["surveys"],queryFn:async()=>await (0,d.x6)()});return n?(0,s.jsx)("div",{className:"text-text-2 text-sm text-center px-2",children:"加载中..."}):i?(0,s.jsxs)("div",{className:"flex flex-col gap-2 items-center",children:[(0,s.jsx)("div",{className:"text-danger",children:"加载失败"}),(0,s.jsx)(l.zx,{onClick:()=>r(),children:"重试"})]}):(null==a?void 0:a.length)===0?(0,s.jsx)("div",{className:"text-text-2 text-sm text-center px-2",children:"暂无表单"}):(0,s.jsx)("div",{className:"p-4 flex flex-col gap-1 items-stretch",children:a.map(e=>(0,s.jsx)(p.rU,{to:"/survey/$surveyId",params:{surveyId:e.id},className:(0,j.cn)("px-3 py-2 rounded hover:bg-fill-1 active:bg-fill-2",e.id===t&&"text-primary bg-primary-light-default"),children:e.title},e.id))})}function k(e){let{surveyId:t,schema:a}=e,{data:n,isError:i,isPending:r,refetch:c}=(0,u.a)({queryKey:["answers",t],queryFn:async()=>t?(0,d.X2)(t):null,enabled:!!t});return t?r?(0,s.jsx)("div",{className:"text-text-2 text-sm text-center px-2",children:"加载中..."}):i?(0,s.jsxs)("div",{className:"flex flex-col gap-2 items-center",children:[(0,s.jsx)("div",{className:"text-danger",children:"加载失败"}),(0,s.jsx)(l.zx,{onClick:()=>c(),children:"重试"})]}):(null==n?void 0:n.length)?(0,s.jsx)("div",{className:"p-4",children:n.map((e,t)=>(0,s.jsx)("div",{className:"border-b py-4",children:(0,s.jsx)(f,{model:a,data:e})},t))}):(0,s.jsx)("div",{className:"text-text-2 text-sm text-center px-2",children:"暂无数据"}):null}},5929:function(e,t,a){a.r(t),a.d(t,{Route:function(){return i}});var s=a(5893),l=a(9627),n=a(8827);let i=(0,l.k0)("/survey/new")({component:function(){return(0,s.jsx)(n.l,{})}})}}]);